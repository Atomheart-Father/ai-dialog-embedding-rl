# å¼ºåŒ–å­¦ä¹ å¯¹è¯ç³»ç»Ÿé¡¹ç›®è¯¦ç»†ä»‹ç»

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºå¼ºåŒ–å­¦ä¹ çš„å¤šè½®å¯¹è¯ç³»ç»Ÿï¼Œå®ç°äº†å†å²å‹ç¼©ä¸å¯¹è¯ç”Ÿæˆçš„è”åˆä¼˜åŒ–ã€‚ç³»ç»Ÿé‡‡ç”¨åŒæ¨¡å‹æ¶æ„ï¼š**å†å²å‹ç¼©æ¨¡å‹** + **å¯¹è¯ç”Ÿæˆæ¨¡å‹**ï¼Œé€šè¿‡å¼ºåŒ–å­¦ä¹ è®­ç»ƒæ¥ä¼˜åŒ–é•¿å¯¹è¯åœºæ™¯ä¸‹çš„æ€§èƒ½ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **æ™ºèƒ½å†å²å‹ç¼©**ï¼šåŸºäºå¼ºåŒ–å­¦ä¹ çš„è‡ªé€‚åº”å†å²å‹ç¼©ç­–ç•¥
- **å¤šç­–ç•¥å‹ç¼©**ï¼šæ”¯æŒæœ€è¿‘é‡ç‚¹ã€ä¸»é¢˜é‡ç‚¹ã€å®ä½“é‡ç‚¹ã€å¹³è¡¡ç­–ç•¥ç­‰4ç§å‹ç¼©æ–¹å¼
- **åŠ¨æ€å‹ç¼©æ¯”**ï¼šæ ¹æ®å¯¹è¯çŠ¶æ€è‡ªåŠ¨é€‰æ‹©0.2-0.5çš„å‹ç¼©æ¯”ä¾‹
- **å¥–åŠ±æœºåˆ¶**ï¼šè´¨é‡å¥–åŠ±(40%) + å‹ç¼©å¥–åŠ±(30%) + è¿è´¯æ€§å¥–åŠ±(30%)
- **å®éªŒæ¡†æ¶**ï¼šå®Œæ•´çš„å››å¯¹ç…§ç»„å®éªŒè¯„ä¼°ä½“ç³»

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
vest.ai1/
â”œâ”€â”€ ğŸ“ models/                    # æ¨¡å‹å­˜å‚¨ç›®å½•
â”‚   â””â”€â”€ models--Qwen--Qwen2.5-0.5B-Instruct/
â”œâ”€â”€ ğŸ“ rl_training/              # è®­ç»ƒè®°å½•å’Œæ£€æŸ¥ç‚¹
â”œâ”€â”€ ğŸ“ logs/                     # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ ğŸ main.py                   # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ ğŸ config.py                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ models.py                 # æ¨¡å‹ç®¡ç†å™¨
â”œâ”€â”€ ğŸ dialog_manager.py         # å¯¹è¯ç®¡ç†å™¨
â”œâ”€â”€ ğŸ compressor.py             # å†å²å‹ç¼©å™¨
â”œâ”€â”€ ğŸ rl_trainer.py             # å¼ºåŒ–å­¦ä¹ è®­ç»ƒå™¨
â”œâ”€â”€ ğŸ reward_calculator.py      # å¥–åŠ±è®¡ç®—å™¨
â”œâ”€â”€ ğŸ rl_main.py                # RLè®­ç»ƒä¸»ç¨‹åº
â”œâ”€â”€ ğŸ““ rl_experiment.ipynb       # å®éªŒè¯„ä¼°æ¡†æ¶
â”œâ”€â”€ ğŸ quick_start.py            # å¿«é€Ÿå¼€å§‹è„šæœ¬
â””â”€â”€ ğŸ“„ requirements.txt          # ä¾èµ–åŒ…åˆ—è¡¨
```

## ğŸ§  æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. æ¨¡å‹ç®¡ç†å™¨ (`models.py`)

**åŠŸèƒ½**ï¼šç»Ÿä¸€ç®¡ç†å‹ç¼©æ¨¡å‹å’Œå¯¹è¯æ¨¡å‹çš„åŠ è½½ã€æ¨ç†

**å…³é”®ç‰¹æ€§**ï¼š
- è‡ªåŠ¨æ£€æµ‹MPS/CUDAåŠ é€Ÿ
- Hugging Faceæ¨¡å‹é›†æˆ
- Tokenè®¡æ•°å’Œæ–‡æœ¬ç”Ÿæˆ
- æ¨¡å‹ç¼“å­˜ç®¡ç†

**æ¨¡å‹é…ç½®**ï¼š
```python
model_config = {
    'model_name': 'Qwen/Qwen2.5-0.5B-Instruct',
    'model_path': './models/models--Qwen--Qwen2.5-0.5B-Instruct',
    'device_map': 'auto',
    'torch_dtype': 'auto'
}
```

### 2. å¯¹è¯ç®¡ç†å™¨ (`dialog_manager.py`)

**åŠŸèƒ½**ï¼šç®¡ç†å¤šè½®å¯¹è¯çŠ¶æ€ï¼Œåè°ƒå‹ç¼©å’Œç”Ÿæˆè¿‡ç¨‹

**å…³é”®ç‰¹æ€§**ï¼š
- å¯¹è¯å†å²ç»´æŠ¤
- å‹ç¼©è§¦å‘é€»è¾‘
- ä¸Šä¸‹æ–‡ç®¡ç†
- ä¼šè¯çŠ¶æ€ä¿å­˜

**å‹ç¼©è§¦å‘æ¡ä»¶**ï¼š
- Tokenæ•°é‡ > 1500 (å¯é…ç½®)
- å¯¹è¯è½®æ¬¡ > 6è½® (å¯é…ç½®)

### 3. å†å²å‹ç¼©å™¨ (`compressor.py`)

**åŠŸèƒ½**ï¼šæ™ºèƒ½å‹ç¼©å¯¹è¯å†å²ï¼Œä¿ç•™å…³é”®ä¿¡æ¯

**å‹ç¼©ç­–ç•¥**ï¼š
- `recent_focus`ï¼šé‡ç‚¹ä¿ç•™æœ€è¿‘å¯¹è¯
- `topic_focus`ï¼šé‡ç‚¹ä¿ç•™ä¸»é¢˜ç›¸å…³å†…å®¹
- `entity_focus`ï¼šé‡ç‚¹ä¿ç•™å®ä½“ä¿¡æ¯
- `balanced`ï¼šå¹³è¡¡ä¿ç•™å„ç±»ä¿¡æ¯

**å‹ç¼©æ¯”ä¾‹**ï¼š[0.2, 0.3, 0.4, 0.5]

### 4. å¼ºåŒ–å­¦ä¹ è®­ç»ƒå™¨ (`rl_trainer.py`)

**åŠŸèƒ½**ï¼šåŸºäºå¥–åŠ±ä¿¡å·è®­ç»ƒæœ€ä¼˜å‹ç¼©ç­–ç•¥

**åŠ¨ä½œç©ºé—´**ï¼š16ç§ç»„åˆï¼ˆ4ç§å‹ç¼©æ¯” Ã— 4ç§ç­–ç•¥ï¼‰

**çŠ¶æ€è¡¨ç¤º**ï¼š
- æ–‡æœ¬é•¿åº¦ç‰¹å¾
- å¯¹è¯è½®æ¬¡ç‰¹å¾  
- Tokenæ•°é‡ç‰¹å¾

**è®­ç»ƒç®—æ³•**ï¼šÎµ-è´ªå¿ƒç­–ç•¥ + ç»éªŒå›æ”¾

### 5. å¥–åŠ±è®¡ç®—å™¨ (`reward_calculator.py`)

**åŠŸèƒ½**ï¼šè®¡ç®—å¤šç»´åº¦å¥–åŠ±ä¿¡å·æŒ‡å¯¼è®­ç»ƒ

**å¥–åŠ±ç»„æˆ**ï¼š
```python
æ€»å¥–åŠ± = è´¨é‡å¥–åŠ± Ã— 0.4 + å‹ç¼©å¥–åŠ± Ã— 0.3 + è¿è´¯æ€§å¥–åŠ± Ã— 0.3
```

**è¯„ä¼°ç»´åº¦**ï¼š
- **è´¨é‡å¥–åŠ±**ï¼šå›å¤é•¿åº¦åˆç†æ€§ã€ç›¸å…³æ€§ã€æµç•…æ€§
- **å‹ç¼©å¥–åŠ±**ï¼šå‹ç¼©æ¯”ä¼˜åŒ–ã€TokenèŠ‚çœæ•ˆæœ
- **è¿è´¯æ€§å¥–åŠ±**ï¼šå†å²ä¸€è‡´æ€§ã€ä¸Šä¸‹æ–‡è¿è´¯æ€§

## ğŸ”§ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®æ–‡ä»¶ (`config.py`)

```python
# æ¨¡å‹é…ç½®
model_config = {
    'model_name': 'Qwen/Qwen2.5-0.5B-Instruct',
    'model_path': './models/models--Qwen--Qwen2.5-0.5B-Instruct',
    'max_length': 2048,
    'temperature': 0.7,
    'do_sample': True
}

# å¯¹è¯é…ç½®
dialog_config = {
    'max_history_length': 10,
    'trigger_compression_tokens': 1500,
    'keep_recent_turns': 3,
    'conversation_timeout': 3600
}

# å¼ºåŒ–å­¦ä¹ é…ç½®
rl_config = {
    'learning_rate': 0.001,
    'discount_factor': 0.95,
    'epsilon_start': 1.0,
    'epsilon_end': 0.1,
    'epsilon_decay': 1000,
    'save_checkpoint_interval': 100
}
```

## ğŸš€ è¿è¡Œæ–¹å¼

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æ£€æŸ¥Pythonç‰ˆæœ¬ (æ¨è 3.9+)
python --version
```

### 2. å¿«é€Ÿå¼€å§‹

```bash
# å¿«é€Ÿä½“éªŒ
python quick_start.py

# å®Œæ•´å¯¹è¯ä½“éªŒ
python main.py

# å¼ºåŒ–å­¦ä¹ è®­ç»ƒ
python rl_main.py
```

### 3. å®éªŒè¯„ä¼°

```bash
# å¯åŠ¨Jupyter
jupyter notebook

# æ‰“å¼€å®éªŒæ¡†æ¶
# rl_experiment.ipynb
```

## ğŸ“Š å®éªŒæ¡†æ¶

### å››å¯¹ç…§ç»„è®¾è®¡

| ç»„åˆ« | å†å²å‹ç¼© | RLè®­ç»ƒ | é¢„æœŸæ•ˆæœ |
|------|----------|--------|----------|
| åŸºçº¿ç»„ | âŒ | âŒ | åŸºå‡†æ€§èƒ½ |
| å‹ç¼©ç»„ | âœ… | âŒ | å‹ç¼©æ•ˆæœ |
| è®­ç»ƒç»„ | âŒ | âœ… | RLä¼˜åŒ–æ•ˆæœ |
| å®Œæ•´ç»„ | âœ… | âœ… | æœ€ä¼˜æ€§èƒ½ |

### è¯„ä¼°æŒ‡æ ‡

**è‡ªåŠ¨åŒ–æŒ‡æ ‡**ï¼š
- BLEUã€ROUGEã€Perplexity
- Distinct-N (å¤šæ ·æ€§)
- BERTScore (è¯­ä¹‰ç›¸ä¼¼åº¦)

**å¯¹è¯ç‰¹å®šæŒ‡æ ‡**ï¼š
- ä¸Šä¸‹æ–‡è¿è´¯æ€§
- ä¿¡æ¯ä¿æŒç‡
- å›å¤æ°å½“æ€§

**å‹ç¼©ç‰¹å®šæŒ‡æ ‡**ï¼š
- å‹ç¼©æ¯”ç‡
- ä¿¡æ¯æŸå¤±ç‡
- å‹ç¼©è´¨é‡

### æµ‹è¯•æ•°æ®é›†

1. **æŠ€æœ¯è®¨è®º**ï¼šæµ‹è¯•ä¸“ä¸šæœ¯è¯­ä¿æŒèƒ½åŠ›
2. **æ—¥å¸¸å¯¹è¯**ï¼šæµ‹è¯•æƒ…æ„Ÿå’Œè¯­å¢ƒä¿æŒ
3. **é—®é¢˜è§£å†³**ï¼šæµ‹è¯•é€»è¾‘æ¨ç†èƒ½åŠ›
4. **çŸ¥è¯†é—®ç­”**ï¼šæµ‹è¯•çŸ¥è¯†ä¸€è‡´æ€§
5. **æ··åˆä¸»é¢˜**ï¼šæµ‹è¯•ä¸»é¢˜åˆ‡æ¢é€‚åº”æ€§

## ğŸ’¾ æ•°æ®å’Œæ¨¡å‹

### æ¨¡å‹å­˜å‚¨ä½ç½®

```
models/
â””â”€â”€ models--Qwen--Qwen2.5-0.5B-Instruct/
    â”œâ”€â”€ snapshots/
    â”‚   â””â”€â”€ 7ae557604adf67be50417f59c2c2f167def9a775/
    â”‚       â”œâ”€â”€ config.json
    â”‚       â”œâ”€â”€ model.safetensors
    â”‚       â”œâ”€â”€ tokenizer.json
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ blobs/
    â””â”€â”€ refs/
```

### è®­ç»ƒæ•°æ®è®°å½•

```
rl_training/
â”œâ”€â”€ checkpoint_episode_100.json
â”œâ”€â”€ checkpoint_episode_200.json
â”œâ”€â”€ training_progress_YYYYMMDD_HHMMSS.json
â””â”€â”€ final_results_YYYYMMDD_HHMMSS.json
```

### æ—¥å¿—æ–‡ä»¶

```
logs/
â”œâ”€â”€ system.log              # ç³»ç»Ÿè¿è¡Œæ—¥å¿—
â”œâ”€â”€ rl_training.log         # RLè®­ç»ƒæ—¥å¿—
â””â”€â”€ dialog_YYYYMMDD.log     # å¯¹è¯è®°å½•
```

## ğŸ” æ ¸å¿ƒç®—æ³•æµç¨‹

### 1. å¯¹è¯å¤„ç†æµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ çŠ¶æ€è¯„ä¼° â†’ å‹ç¼©å†³ç­– â†’ å†å²å‹ç¼© â†’ å›å¤ç”Ÿæˆ â†’ çŠ¶æ€æ›´æ–°
    â†“            â†“          â†“          â†“          â†“
å†å²ç»´æŠ¤    Tokenè®¡æ•°    RLåŠ¨ä½œé€‰æ‹©   æ™ºèƒ½æ‘˜è¦    ä¸Šä¸‹æ–‡ç®¡ç†
```

### 2. å¼ºåŒ–å­¦ä¹ è®­ç»ƒæµç¨‹

```
åˆå§‹çŠ¶æ€ â†’ åŠ¨ä½œé€‰æ‹© â†’ ç¯å¢ƒäº¤äº’ â†’ å¥–åŠ±è®¡ç®— â†’ ç»éªŒå­˜å‚¨ â†’ æ¨¡å‹æ›´æ–°
    â†“         â†“         â†“         â†“         â†“         â†“
å¯¹è¯å†å²   å‹ç¼©ç­–ç•¥   æ‰§è¡Œå‹ç¼©   å¤šç»´è¯„ä¼°   å›æ”¾ç¼“å†²   ç­–ç•¥ä¼˜åŒ–
```

### 3. å‹ç¼©ç­–ç•¥é€‰æ‹©

```python
if token_count > 2000:
    action = high_compression_action()  # 0.2å‹ç¼©æ¯”
elif token_count > 1500:
    action = medium_compression_action()  # 0.3å‹ç¼©æ¯”
else:
    action = light_compression_action()  # 0.4å‹ç¼©æ¯”
```

## ğŸ›ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰å‹ç¼©ç­–ç•¥

```python
# åœ¨ compressor.py ä¸­æ·»åŠ æ–°ç­–ç•¥
custom_strategies = {
    'emotion_focus': "é‡ç‚¹ä¿ç•™æƒ…æ„Ÿè¡¨è¾¾å’Œè¯­æ°”è¯",
    'technical_focus': "é‡ç‚¹ä¿ç•™æŠ€æœ¯æœ¯è¯­å’Œä¸“ä¸šæ¦‚å¿µ"
}
```

### è‡ªå®šä¹‰å¥–åŠ±å‡½æ•°

```python
# åœ¨ reward_calculator.py ä¸­è°ƒæ•´æƒé‡
reward_weights = {
    'quality_weight': 0.5,     # æé«˜è´¨é‡æƒé‡
    'compression_weight': 0.2,  # é™ä½å‹ç¼©æƒé‡
    'coherence_weight': 0.3     # ä¿æŒè¿è´¯æ€§æƒé‡
}
```

### æ¨¡å‹åˆ‡æ¢

```python
# åœ¨ config.py ä¸­ä¿®æ”¹æ¨¡å‹
model_config['model_name'] = 'Qwen/Qwen2.5-1.5B-Instruct'
model_config['model_path'] = './models/larger_model'
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡å‹åŠ è½½å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ¨¡å‹æ–‡ä»¶å®Œæ•´æ€§
   ls -la models/models--Qwen--Qwen2.5-0.5B-Instruct/
   
   # é‡æ–°ä¸‹è½½æ¨¡å‹
   python -c "from models import model_manager; model_manager.download_model()"
   ```

2. **å†…å­˜ä¸è¶³**
   ```python
   # å‡å°æ¨¡å‹ç²¾åº¦
   model_config['torch_dtype'] = torch.float16
   
   # å‡å°batch size
   rl_config['batch_size'] = 16
   ```

3. **è®­ç»ƒä¸æ”¶æ•›**
   ```python
   # è°ƒæ•´å­¦ä¹ ç‡
   rl_config['learning_rate'] = 0.0001
   
   # å¢åŠ æ¢ç´¢æ—¶é—´
   rl_config['epsilon_decay'] = 2000
   ```

### æ€§èƒ½ä¼˜åŒ–

1. **ä½¿ç”¨MPSåŠ é€Ÿ** (Apple Silicon)
   ```python
   device_config['force_mps'] = True
   ```

2. **æ‰¹é‡å¤„ç†**
   ```python
   rl_config['batch_size'] = 32
   rl_config['update_frequency'] = 10
   ```

3. **æ¨¡å‹é‡åŒ–**
   ```python
   model_config['load_in_8bit'] = True
   ```

## ğŸ“ˆ é¢„æœŸç»“æœ

### æ€§èƒ½æ”¹è¿›é¢„æœŸ

- **å‹ç¼©ç»„ vs åŸºçº¿ç»„**ï¼š15-25% æ€§èƒ½æå‡
- **è®­ç»ƒç»„ vs åŸºçº¿ç»„**ï¼š10-20% æ€§èƒ½æå‡  
- **å®Œæ•´ç»„ vs åŸºçº¿ç»„**ï¼š25-40% æ€§èƒ½æå‡

### æ’åé¢„æœŸ

```
1. å®Œæ•´ç»„ (å‹ç¼©+RL)    â†’ æœ€é«˜æ€§èƒ½
2. è®­ç»ƒç»„ (ä»…RL)       â†’ ä¸­é«˜æ€§èƒ½
3. å‹ç¼©ç»„ (ä»…å‹ç¼©)     â†’ ä¸­ç­‰æ€§èƒ½
4. åŸºçº¿ç»„ (æ— ä¼˜åŒ–)     â†’ åŸºå‡†æ€§èƒ½
```

## ğŸ“š æ‰©å±•é˜…è¯»

- [å¼ºåŒ–å­¦ä¹ åŸºç¡€](https://spinningup.openai.com/)
- [Transformeræ¨¡å‹è¯¦è§£](https://huggingface.co/docs/transformers/)
- [å¯¹è¯ç³»ç»Ÿè®¾è®¡](https://arxiv.org/abs/1907.05774)
- [å†å²å‹ç¼©æŠ€æœ¯](https://arxiv.org/abs/2109.08141)

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ Issue
- å‘é€é‚®ä»¶
- åŠ å…¥è®¨è®ºç¾¤

---

**å¼€å§‹æ¢ç´¢å¼ºåŒ–å­¦ä¹ å¯¹è¯ç³»ç»Ÿçš„é­…åŠ›å§ï¼** ğŸš€ 