# ğŸ¤– å¼ºåŒ–å­¦ä¹ å¯¹è¯ç³»ç»Ÿ

åŸºäºå¼ºåŒ–å­¦ä¹ çš„æ™ºèƒ½å¤šè½®å¯¹è¯ç³»ç»Ÿï¼Œå®ç°å†å²å‹ç¼©ä¸å¯¹è¯ç”Ÿæˆçš„è”åˆä¼˜åŒ–ã€‚

[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-ee4c2c.svg)](https://pytorch.org/)
[![Transformers](https://img.shields.io/badge/ğŸ¤—-Transformers-yellow.svg)](https://huggingface.co/transformers/)

## âœ¨ ç‰¹è‰²åŠŸèƒ½

### ğŸ¯ æ–°æ¨å‡ºï¼šç›´æ¥Embeddingå‹ç¼©æ–¹æ¡ˆ
- ğŸ§  **ç›´æ¥ä½¿ç”¨æ¨¡å‹å†…éƒ¨çŠ¶æ€**ï¼šæå–hidden statesè¿›è¡Œä¸Šä¸‹æ–‡å‹ç¼©
- ğŸ’¾ **æ™ºèƒ½State Bank**ï¼šå­˜å‚¨å’Œæ£€ç´¢å†å²å¯¹è¯çš„å‘é‡è¡¨ç¤º
- ğŸ”§ **å››ç§èåˆç­–ç•¥**ï¼šattentionã€weighted_sumã€concatenationã€interpolation
- âš¡ **é›¶ä¾èµ–**ï¼šæ— éœ€é¢å¤–embeddingæ¨¡å‹ï¼Œç›´æ¥åˆ©ç”¨ä¸»æ¨¡å‹
- ğŸ“ **é«˜æ•ˆå‹ç¼©**ï¼šå›ºå®šé•¿åº¦å‘é‡ vs å¯å˜é•¿åº¦æ–‡æœ¬

### ğŸ“‹ åŸæœ‰åŠŸèƒ½  
- ğŸ§  **æ™ºèƒ½å†å²å‹ç¼©**ï¼šåŸºäºå¼ºåŒ–å­¦ä¹ çš„è‡ªé€‚åº”å‹ç¼©ç­–ç•¥
- ğŸ¯ **å¤šç­–ç•¥å‹ç¼©**ï¼šæ”¯æŒ4ç§å‹ç¼©ç­–ç•¥å’ŒåŠ¨æ€å‹ç¼©æ¯”
- ğŸ† **å¤šç»´å¥–åŠ±æœºåˆ¶**ï¼šè´¨é‡+å‹ç¼©+è¿è´¯æ€§çš„ç»¼åˆä¼˜åŒ–
- ğŸ“Š **å®Œæ•´å®éªŒæ¡†æ¶**ï¼šå››å¯¹ç…§ç»„ç§‘å­¦è¯„ä¼°ä½“ç³»
- ğŸš€ **MPS/CUDAåŠ é€Ÿ**ï¼šæ”¯æŒApple Siliconå’ŒNVIDIA GPU

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/<your-username>/<repository-name>.git
cd <repository-name>

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. ğŸ¯ æ¨èï¼šä½“éªŒç›´æ¥Embeddingå‹ç¼©

**è¿™æ˜¯åŸºäºæ‚¨éœ€æ±‚è®¾è®¡çš„æ ¸å¿ƒæ–¹æ¡ˆï¼šç›´æ¥ä½¿ç”¨å¤§æ¨¡å‹internal stateï¼**

```bash
# ç›´æ¥Embeddingå‹ç¼©æ¼”ç¤ºï¼ˆæ¨èï¼ï¼‰
python quick_start_direct_embedding.py

# å®Œæ•´æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
python test_direct_embedding.py

# Jupyterå®éªŒå¯¹æ¯”
jupyter notebook rl_experiment.ipynb
```

### 3. ğŸ“‹ ä¼ ç»ŸRLæ–¹æ¡ˆä½“éªŒ

```bash
# å¿«é€Ÿå¯¹è¯ä½“éªŒ
python quick_start.py

# å®Œæ•´ç³»ç»Ÿæ¼”ç¤º
python main.py

# å¼ºåŒ–å­¦ä¹ è®­ç»ƒ
python rl_main.py
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ğŸ¯ ç›´æ¥Embeddingå‹ç¼©æ¶æ„
```
ğŸ“¦ æ ¸å¿ƒç»„ä»¶
â”œâ”€â”€ ğŸ§  Direct Embedding Compressor  # ç›´æ¥embeddingå‹ç¼©å™¨
â”‚   â”œâ”€â”€ ğŸ¦ Hidden State Bank        # çŠ¶æ€é“¶è¡Œ
â”‚   â”œâ”€â”€ ğŸ”§ Fusion Strategies        # èåˆç­–ç•¥
â”‚   â””â”€â”€ ğŸ” Similarity Retrieval     # ç›¸ä¼¼åº¦æ£€ç´¢
â”œâ”€â”€ ğŸ¯ Dialog Manager              # å¯¹è¯ç®¡ç†å™¨
â””â”€â”€ ğŸ”§ Model Manager               # æ¨¡å‹ç®¡ç†å™¨
```

### ğŸ“‹ ä¼ ç»ŸRLæ¶æ„
```
ğŸ“¦ æ ¸å¿ƒç»„ä»¶
â”œâ”€â”€ ğŸ¯ Dialog Manager    # å¯¹è¯ç®¡ç†å™¨
â”œâ”€â”€ ğŸ—œï¸ Compressor        # å†å²å‹ç¼©å™¨  
â”œâ”€â”€ ğŸ¤– RL Trainer        # å¼ºåŒ–å­¦ä¹ è®­ç»ƒå™¨
â”œâ”€â”€ ğŸ† Reward Calculator # å¥–åŠ±è®¡ç®—å™¨
â””â”€â”€ ğŸ”§ Model Manager     # æ¨¡å‹ç®¡ç†å™¨
```

## ğŸ“Š å››å¯¹ç…§ç»„å®éªŒ

| ç»„åˆ« | å†å²å‹ç¼© | RLè®­ç»ƒ | é¢„æœŸæ•ˆæœ |
|------|:--------:|:------:|----------|
| åŸºçº¿ç»„ | âŒ | âŒ | åŸºå‡†æ€§èƒ½ |
| å‹ç¼©ç»„ | âœ… | âŒ | å‹ç¼©æ•ˆæœ (+15-25%) |
| è®­ç»ƒç»„ | âŒ | âœ… | RLä¼˜åŒ– (+10-20%) |
| å®Œæ•´ç»„ | âœ… | âœ… | æœ€ä¼˜æ€§èƒ½ (+25-40%) |

## ğŸ’¡ æ ¸å¿ƒç®—æ³•

### å‹ç¼©ç­–ç•¥ç©ºé—´
- **å‹ç¼©æ¯”**ï¼š[0.2, 0.3, 0.4, 0.5]
- **ç­–ç•¥ç±»å‹**ï¼šæœ€è¿‘é‡ç‚¹ã€ä¸»é¢˜é‡ç‚¹ã€å®ä½“é‡ç‚¹ã€å¹³è¡¡ç­–ç•¥
- **åŠ¨ä½œç©ºé—´**ï¼š16ç§ç­–ç•¥ç»„åˆ (4Ã—4)

### å¥–åŠ±å‡½æ•°è®¾è®¡
```python
æ€»å¥–åŠ± = è´¨é‡å¥–åŠ±Ã—0.4 + å‹ç¼©å¥–åŠ±Ã—0.3 + è¿è´¯æ€§å¥–åŠ±Ã—0.3
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
vest.ai1/
ğŸ¯ ç›´æ¥Embeddingæ–¹æ¡ˆ
â”œâ”€â”€ ğŸ direct_embedding_compressor.py    # ç›´æ¥embeddingå‹ç¼©å™¨
â”œâ”€â”€ ğŸ test_direct_embedding.py          # ç›´æ¥embeddingæµ‹è¯•
â”œâ”€â”€ ğŸ quick_start_direct_embedding.py   # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ ğŸ rl_trainer_embedding.py           # embeddingå¢å¼ºRLè®­ç»ƒå™¨

ğŸ“‹ ä¼ ç»Ÿæ–¹æ¡ˆ
â”œâ”€â”€ ğŸ main.py                   # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ ğŸ compressor.py             # å†å²å‹ç¼©å™¨
â”œâ”€â”€ ğŸ rl_trainer.py             # RLè®­ç»ƒå™¨
â”œâ”€â”€ ğŸ embedding_compressor.py   # ä¼ ç»Ÿembeddingå‹ç¼©å™¨

ğŸ”§ å…±äº«ç»„ä»¶
â”œâ”€â”€ ğŸ config.py                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ models.py                 # æ¨¡å‹ç®¡ç†å™¨
â”œâ”€â”€ ğŸ dialog_manager.py         # å¯¹è¯ç®¡ç†å™¨
â”œâ”€â”€ ğŸ reward_calculator.py      # å¥–åŠ±è®¡ç®—å™¨
â”œâ”€â”€ ğŸ““ rl_experiment.ipynb       # å®Œæ•´å®éªŒæ¡†æ¶

ğŸ“ æ•°æ®å’Œæ—¥å¿—
â”œâ”€â”€ ğŸ“ models/                   # æ¨¡å‹å­˜å‚¨
â”œâ”€â”€ ğŸ“ rl_training/              # è®­ç»ƒè®°å½•
â””â”€â”€ ğŸ“ logs/                     # æ—¥å¿—æ–‡ä»¶
```

## ğŸ›ï¸ å…³é”®é…ç½®

```python
# å‹ç¼©è§¦å‘æ¡ä»¶
trigger_compression_tokens = 1500  # Tokenæ•°é˜ˆå€¼
keep_recent_turns = 3              # ä¿ç•™æœ€è¿‘è½®æ¬¡

# RLè®­ç»ƒå‚æ•°  
learning_rate = 0.001              # å­¦ä¹ ç‡
epsilon_start = 1.0                # åˆå§‹æ¢ç´¢ç‡
epsilon_decay = 1000               # æ¢ç´¢è¡°å‡

# æ¨¡å‹è®¾ç½®
model_name = 'Qwen/Qwen2.5-0.5B-Instruct'  # åŸºç¡€æ¨¡å‹
```

## ğŸ“ˆ é¢„æœŸç»“æœ

### æ€§èƒ½æ’å
1. ğŸ¥‡ **å®Œæ•´ç»„** (å‹ç¼©+RL) - æœ€ä¼˜æ€§èƒ½
2. ğŸ¥ˆ **è®­ç»ƒç»„** (ä»…RL) - ä¸­é«˜æ€§èƒ½  
3. ğŸ¥‰ **å‹ç¼©ç»„** (ä»…å‹ç¼©) - ä¸­ç­‰æ€§èƒ½
4. ğŸ“Š **åŸºçº¿ç»„** (æ— ä¼˜åŒ–) - åŸºå‡†æ€§èƒ½

### è¯„ä¼°æŒ‡æ ‡
- **è‡ªåŠ¨åŒ–æŒ‡æ ‡**ï¼šBLEUã€ROUGEã€BERTScore
- **å¯¹è¯æŒ‡æ ‡**ï¼šè¿è´¯æ€§ã€ä¿¡æ¯ä¿æŒã€æ°å½“æ€§
- **å‹ç¼©æŒ‡æ ‡**ï¼šå‹ç¼©æ¯”ã€ä¿¡æ¯æŸå¤±ã€å‹ç¼©è´¨é‡

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
```bash
# æ¨¡å‹åŠ è½½å¤±è´¥
python -c "from models import model_manager; model_manager.download_model()"

# å†…å­˜ä¸è¶³
# åœ¨config.pyä¸­è®¾ç½®: torch_dtype = torch.float16

# è®­ç»ƒä¸æ”¶æ•›  
# è°ƒæ•´å­¦ä¹ ç‡: learning_rate = 0.0001
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- ğŸ“– [å®Œæ•´é¡¹ç›®æ–‡æ¡£](PROJECT_OVERVIEW.md) - è¯¦ç»†çš„ç³»ç»Ÿä»‹ç»å’Œé…ç½®è¯´æ˜
- ğŸ““ [å®éªŒæŒ‡å—](RL_EXPERIMENT_GUIDE.md) - å®éªŒè®¾è®¡å’Œè¯„ä¼°æ–¹æ³•
- ğŸš€ [å¿«é€Ÿå…¥é—¨](QUICKSTART.md) - æ–°æ‰‹å‹å¥½çš„ä½¿ç”¨æŒ‡å—

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼è¯·æŸ¥çœ‹[è´¡çŒ®æŒ‡å—](CONTRIBUTING.md)äº†è§£è¯¦æƒ…ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)

---

**ğŸ‰ å¼€å§‹æ‚¨çš„å¼ºåŒ–å­¦ä¹ å¯¹è¯ç³»ç»Ÿä¹‹æ—…ï¼**

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹[è¯¦ç»†æ–‡æ¡£](PROJECT_OVERVIEW.md)æˆ–æäº¤Issueã€‚ 